
# Приложение Instalistener

Используется SQLite 3

## Таблица ig_tracking_accounts 
В талице accounts хранятся все аккаунты для отслеживания

    id - идентификатор аккаунта
    username - имя аккаунта
    status - статус аккаунта (1 отслеживается, 0 не отслеживается)
    is_new - новый аккаунт (1 если новый, 0 если старый)
    created_at - дата создания аккаунта
    updated_at - дата последнего изменения аккаунта
    tracking_end_date - дата окончания трекинга аккаунта

## Таблица ig_account_medias
    id -
    account_id -
    ig_shortcode -
    url - 
    caption - 
    thumbnail_url - 
    is_video -
    is_new - 
    created_at -
    updated_at -

## Техническая реализация
Запускаем процесс приложения pm2 start ./app_instlistener.js

- [x] 1. Инициализация класса DB для работы с БД sqlite, подключение к БД для работы с приложением
- [x] 2. Инициализация класса AccountManager для работы с аккаунтами
    - AccountManager собирает аккаунты из таблицы accounts со статусом 1 и датой окончания трекинга не привышающей текущую. Если дата окончания трекинга просрочена, у аккаунта меняется статус на 0
    - Возвращает аккаунты для трекинга
- [x] 3. Если AccountManager возвращает аккаунты, инициализируем Selenium в данном случаи мы работаем с SeleniumEdge. Входим в инстаграм используя системный аккаунт 
- [x] 4. Инициализируется класс AccountScanner, передаем ему экземпляр селениума для сканирования аккаунов полученных от AccountManager, а также экземпляр DB для работы с базой данных
    [x] - AccountScanner имеет параметры настройки: время сканирования аккаунтов, каждые N секунд. Каждый раз при запуска скана аккаунтов, получается свежий актуальный список аккаунтов с помощь AccountManager который делает запрос к БД, так как во время работы аккаунты могут быть удалены из отслеживания.
    [x] - По каждому аккаунта проводится скан получения публикаций, если аккаунт новый поле is_new = 1, берется первый пост и сохраняется в таблицу `ig_account_medias` с полем `is_new` = 1, далее пропускается и в ig_tracking_accounts также выставляется `is_new`=0. Если аккаунт не новый, определяются новый посты и добавляются в `accounts_medias` со значение `is_new`=1. Сохраняет информация о посте со ссылкой на него, подписью, превью и типом видео или фото.
    [x] - Ведутся логи вывод AccountScanner в ./logs/scan_{date}.log
- 5. Инициализируется веб сервер для открытия API для управления веб приложением
    - Авторизация по токену
    - Методы API:
        - /api/v1/account/all - вывод списка всех аккаунтов
        - /api/v1/account/add - добавление аккаунта
            - username
            - tracking_end_date
        - /api/v1/account/{id} - вывод информации об аккаунте
        - /api/v1/account/{id}/medias - получение постов ака
        - /api/v1/account/{id}/medias/new - получение новых постов ака
        - /api/v1/account/{id}/delete - удаление аккаунта
        - /api/v1/account/{id}/stop-track - остановка отслеживания аккаунта
        - /api/v1/app/start - запуск приложения
        - /api/v1/app/stop - остановка приложения
        - /api/v1/app/status - получение статуса приложения
Примерно 7 часов с тестированием 6000 тыс.


# TZ
Нужно следить за аккаунтом и запускать на него задания из разных источников с возможностью дальнейшего переключения источника и редактирования задания.
Вводим ссылку на аккаунт и указываем сколько за ним следить(день, неделя, месяц, 3 месяца и т.п.)
В аккаунте есть разные типы постов(фотографии, reels, видео). На разные типы постов разные задания.
Так же должна быть возможность указывать ссылку на пост/сториз и запускать задание, как это сделано и сейчас. То есть мы дорабатываем функционал, а не меняем его.
Мы добавляем задания к аккаунту: выбор панели(название) -> id услуги -> количество(диапазон количества) и время накрутки. 
Как дальше происходит работа с заданием со стороны сервера на конкретном примере:
В аккаунте за которым следим выходит пост-картинка. Мы указали в панели тип поста – фотография и услугу – лайки: 5000-1000 штук в течение 1 дня.
Панель генерит количество лайков рандомно из заданного диапазона. Например 8561. Разбивает на 4 задания и с интервалом 6 часов отправляет эти задания со ссылкой на пост в панель. 
Ссылку на пост нам и предостоит «выдёргивать» самим и мониторить акк каждые 5 минут.
То есть после запуска в панель передается 2000 лайков, потом через 6 часов 3561 лайк, потом через 6 часов  1000 и еще через 6 – 2000. 
Цифры рандомные должны быть. Но в итоге за сутки должны запуститься и выполниться задания на нужное нам количество.
На один пост может быть около 10 различных заданий.
Параллельно будет вестись 20-30 аккаунтов.

Должна быть история по каждому аккаунту, что было запущено, что сделано и т.п. Общая статистика и так далее.